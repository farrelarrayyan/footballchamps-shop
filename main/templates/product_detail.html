{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Product Detail - FootballChamps Shop</title>
{% endblock meta %}

{% block content %}
<div class="bg-gray-900 w-full min-h-screen">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Back Navigation -->
    <div class="mb-6">
      <a href="{% url 'main:show_main' %}" 
         class="text-[#ff7b00] hover:text-[#e06d00] font-medium transition-colors">
        ← Go Back Home
      </a>
    </div>

    <!-- Loading State -->
    <div id="loading-state" 
         class="bg-gray-800 rounded-2xl border border-gray-700 p-12 text-center">
      <svg class="animate-spin h-8 w-8 text-[#ff7b00] inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <p class="text-gray-400 mt-3">Loading product detail...</p>
    </div>

    <!-- Error State -->
    <div id="error-state" 
         class="bg-gray-800 rounded-2xl border border-gray-700 p-12 text-center hidden">
      <div class="text-red-500 text-5xl mb-4">⚠️</div>
      <h3 class="text-lg font-medium text-white mb-2">Failed to load product</h3>
      <p class="text-gray-400">Please try again later.</p>
    </div>

    <!-- Product Detail -->
    <article id="product-detail" 
             class="bg-gray-800 rounded-2xl border border-gray-700 overflow-hidden shadow-lg hidden">
      <!-- Header -->
      <div class="p-6 sm:p-8">
        <div id="badges-container" class="flex flex-wrap items-center gap-2 mb-4"></div>
        
        <h1 id="product-title" 
            class="text-3xl sm:text-4xl font-bold text-white leading-tight mb-4"></h1>

        <div class="flex flex-wrap items-center text-sm text-gray-400 gap-6 mb-4">
          <span>Brand: <span id="product-brand" class="text-gray-200 font-medium"></span></span>
          <span>Stock: <span id="product-stock" class="text-gray-200 font-medium"></span></span>
          <span>Sold: <span id="product-sold" class="text-gray-200 font-medium"></span></span>
        </div>

        <p id="product-price" class="text-2xl font-bold text-[#ff7b00] mb-4"></p>

        <div class="flex items-center text-sm text-gray-400">
          <span>Seller: <span id="product-seller" class="text-gray-200 font-medium"></span></span>
        </div>
      </div>

      <!-- Thumbnail -->
      <div id="thumbnail-container" class="px-6 sm:px-8 bg-gray-700 flex items-center justify-center rounded-lg hidden">
        <img id="product-thumbnail" 
             src="" 
             alt="" 
             class="max-h-96 w-auto object-contain">
      </div>

      <!-- Description -->
      <div class="p-6 sm:p-8">
        <div id="product-description" 
             class="text-gray-300 leading-relaxed whitespace-pre-line text-base sm:text-lg"></div>
      </div>
    </article>
  </div>
</div>

<script>
// Config
const PRODUCT_ID = "{{ product.id }}";
const PRODUCT_DETAIL_ENDPOINT = `{% url 'main:show_json_by_id' '00000000-0000-0000-0000-000000000000' %}`.replace("00000000-0000-0000-0000-000000000000", PRODUCT_ID);

// DOM Elements
const loadingState = document.getElementById("loading-state");
const errorState = document.getElementById("error-state");
const productDetail = document.getElementById("product-detail");
const badgesContainer = document.getElementById("badges-container");
const productTitle = document.getElementById("product-title");
const productBrand = document.getElementById("product-brand");
const productStock = document.getElementById("product-stock");
const productSold = document.getElementById("product-sold");
const productPrice = document.getElementById("product-price");
const productSeller = document.getElementById("product-seller");
const thumbnailContainer = document.getElementById("thumbnail-container");
const productThumbnail = document.getElementById("product-thumbnail");
const productDescription = document.getElementById("product-description");

// State handling
function showState(state) {
  loadingState.classList.toggle("hidden", state !== "loading");
  errorState.classList.toggle("hidden", state !== "error");
  productDetail.classList.toggle("hidden", state !== "ready");
}

// Category labels
const categoryMapping = {
  footwear: "Footwear",
  accessories: "Accessories",
  supplements: "Supplements",
  jersey: "Jersey",
  ball: "Ball",
  other: "Other",
};

// Render detail
function renderProduct(product) {
  productTitle.textContent = product.name;
  document.title = `${product.name} - FootballChamps Shop`;

  // Badges
  badgesContainer.innerHTML = "";
  const categoryBadge = document.createElement("span");
  categoryBadge.className = "inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-[#ff7b00] text-white";
  categoryBadge.textContent = categoryMapping[product.category] || product.category;
  badgesContainer.appendChild(categoryBadge);

  if (product.is_popular) {
    const popularBadge = document.createElement("span");
    popularBadge.className = "inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-yellow-500 text-black";
    popularBadge.textContent = "Popular";
    badgesContainer.appendChild(popularBadge);
  }

  // Detail info
  productBrand.textContent = product.brand;
  productStock.textContent = product.stock;
  productSold.textContent = product.product_sold;
  productPrice.textContent = `Rp ${product.price}`;
  productSeller.textContent = product.username || "Anonymous";

  // Thumbnail
  if (product.thumbnail) {
    productThumbnail.src = product.thumbnail;
    productThumbnail.alt = product.name;
    thumbnailContainer.classList.remove("hidden");
  } else {
    thumbnailContainer.classList.add("hidden");
  }

  // Description
  productDescription.textContent = product.description;
}

// Fetch product detail
async function loadProductDetail() {
  try {
    showState("loading");

    const response = await fetch(PRODUCT_DETAIL_ENDPOINT, { headers: { Accept: "application/json" } });
    if (!response.ok) throw new Error("Failed to fetch product detail");

    const productData = await response.json();
    renderProduct(productData);
    showState("ready");
  } catch (error) {
    console.error("Error loading product detail:", error);
    showState("error");
  }
}

// Initialize page
loadProductDetail();
</script>
{% endblock content %}
